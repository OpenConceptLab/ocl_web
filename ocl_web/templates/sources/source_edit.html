{% extends "base.html" %}
{% load i18n %}
{% load bootstrap3 %}
{% load ocl_tags %}


{% block title %}{% trans "Edit Source" %}{% endblock %}


{% block content %}
{% if source.owner_type == 'Organization' %}
	{% url 'source-home' org=source.owner source=source.id as source_home_url %}
    {% url 'source-delete' org=source.owner source=source.id as source_delete_url %}
{% else %}
	{% url 'source-home' user=source.owner source=source.id as source_home_url %}
    {% url 'source-delete' user=source.owner source=source.id as source_delete_url %}

{% endif %}

<h3>
  {% resource_owner_label source %} / {% source_label source %} / {% trans "Edit Source" %}
  {# TODO: Only show if admin or owner #}
    {% if_can_change source %}
        <a href="{{ source_delete_url }}" class="small text-muted">
            <span class="glyphicon glyphicon-trash"></span>
        </a>
    {% endif_can_change source %}
</h3>

<div class="container">

	<div class="row">
		<div class="col-md-8">
			&nbsp;
			{% field_label 'Short Code' source.short_code %}
			{% field_label 'Created By' source.created_by %}
			{% field_label 'Created On' source.created_on|smart_date %}
			{% field_label 'Owner' source.owner %}
			&nbsp;
		</div>
	</div> {# end row #}

	<div class="row">
		<div class="col-md-8">
			<form id="source_edit_form" method="post" action=".">
				{% csrf_token %}
				{% bootstrap_form form %}
				{% buttons %}
					<button type="submit" class="btn btn-primary">{% trans "Update" %}</button>
				    <a href="{{ source_home_url }}" class="btn btn-default">{% trans "Cancel" %}</a>
				{% endbuttons %}
			</form>
		</div>
	</div> {# end row #}
    {% if failed_concept_validations %}
        <div class="modal fade " id="failed-validations">
            <div class="modal-dialog expanded" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Following resources failed validation against OpenMRS</h4>
                    </div>
                    <div class="modal-body">
                        <table class="table table-striped">
                            <thead>
                                <th>
                                    <tr>
                                        <td>#</td>
                                        <td>Concept</td>
                                        <td>Validation Error</td>
                                    </tr>
                                </th>
                            </thead>
                            <tbody>
                                {% for error in failed_concept_validations %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td><a href="{{ error.url }}">{{ error.mnemonic }}</a></td>
                                        <td>
                                            <ul>
                                                {% for field, messages in error.errors.items %}
                                                    <li><strong>{{ field }}:</strong> {{ messages.0 }}</li>
                                                {% endfor %}
                                            </ul>

                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <input type="button" class="btn btn-default" data-dismiss="modal" value="Close" />
                    </div>
                </div>
            </div>
        </div>
        <script type="text/javascript">
            $('#failed-validations').modal('show');
        </script>
    {% endif %}


</div> {# end container #}

{% endblock %}
