<div class="btn-group" id="add-to-collection-dropdown" style="margin-left:5px; margin-right:5px">
    <button type="button" id="add-to-collection-dropdown-button"
            class="btn btn-block btn-sm btn-default dropdown-toggle transparent disabled" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">Add to Collection <span class="caret"></span></button>
    <div class="collection-list-dropdown dropdown-menu">
        {% if not collections %}
            <div class="no-collections-info-box">
                <span>You do not have any existing collections. Create a collection in your profile.</span>
            </div>
        {% else %}
            <div class="collection-list-container">
                {% for collection in collections %}
                    <div class="{% if collection.owner_type == 'Organization' %}org-collection-radio {% endif %}collection-radio radio">
                        <label>
                            <input type="radio" name="collections" id="user-collection-{{ forloop.counter }}"
                                   value="{{ forloop.counter }}">
                            <input type="hidden" name="collection-owner" id="collection-owner-{{ forloop.counter }}"
                                   value="{{ collection.owner }}">
                            <input type="hidden" name="collection-name" id="collection-name-{{ forloop.counter }}"
                                   value="{{ collection.id }}">
                            <input type="hidden" name="collection-url" id="collection-url-{{ forloop.counter }}"
                                   value="{{ collection.url }}">
                            {{ collection.owner }} / <strong>{{ collection.id }}</strong>
                        </label>
                    </div>
                {% endfor %}
            </div>
            <button type="button" class="add-to-collection-save btn btn-primary btn-block" disabled="disabled">Add
            </button>
        {% endif %}
    </div>
</div>

<script>
    $(document).ready(function () {

        var collectionDropDownItems = $('.collection-list-dropdown div.radio, .collection-list-dropdown input');
        var saveButton = $('.add-to-collection-save');

        collectionDropDownItems.click(function (e) {
            e.stopPropagation();

            if ($('input[name="collections"]:checked').val()) {
                saveButton.attr('disabled', false);
            }
        });

        saveButton.click(function(){
            var numberOfSelectedResources = $('input.search-result-checkbox:checked').length;
            if(numberOfSelectedResources < 1) return;

            var selectedCollectionIndex = $('input[name="collections"]:checked').val();
            var selectedCollectionOwner = $('#collection-owner-' + selectedCollectionIndex).val();
            var selectedCollectionName = $('#collection-name-' + selectedCollectionIndex).val();
            var selectedCollectionURI = $('#collection-url-' + selectedCollectionIndex).val();
            var selectedCollectionLabel = selectedCollectionOwner + '/' + selectedCollectionName;

            $(document).trigger('addToCollectionConfirmationRequired', [numberOfSelectedResources, selectedCollectionLabel, selectedCollectionURI]);

        });
    })
</script>
